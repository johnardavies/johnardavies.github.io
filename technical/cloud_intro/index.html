<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Introduction to launching a Virtual Machine in the Cloud | John&#39;s Site</title>
<meta name="keywords" content="technical, digital" />
<meta name="description" content="Photograph of Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition
More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can seem slightly mysterious to someone whose original background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.">
<meta name="author" content="John Davies">
<link rel="canonical" href="https://johnardavies.github.io/technical/cloud_intro/" />
<link crossorigin="anonymous" href="https://johnardavies.github.io/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css" integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw&#43;W8mWdq36u97PLc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="https://johnardavies.github.io/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://johnardavies.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://johnardavies.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://johnardavies.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://johnardavies.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://johnardavies.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.88.1" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-YJ821LVT08', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-YJ821LVT08"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-YJ821LVT08', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Introduction to launching a Virtual Machine in the Cloud" />
<meta property="og:description" content="Photograph of Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition
More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can seem slightly mysterious to someone whose original background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://johnardavies.github.io/technical/cloud_intro/" />
<meta property="og:image" content="https://johnardavies.github.io/Cloud_image.jpg" /><meta property="article:section" content="technical" />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://johnardavies.github.io/Cloud_image.jpg" />
<meta name="twitter:title" content="Introduction to launching a Virtual Machine in the Cloud"/>
<meta name="twitter:description" content="Photograph of Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition
More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can seem slightly mysterious to someone whose original background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Technicals",
      "item": "https://johnardavies.github.io/technical/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Introduction to launching a Virtual Machine in the Cloud",
      "item": "https://johnardavies.github.io/technical/cloud_intro/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Introduction to launching a Virtual Machine in the Cloud",
  "name": "Introduction to launching a Virtual Machine in the Cloud",
  "description": "Photograph of Es Devlin\u0026rsquo;s \u0026ldquo;BLUEWHITESKY\u0026rdquo; at the 2021 LUX exhibition\nMore and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can seem slightly mysterious to someone whose original background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.",
  "keywords": [
    "technical", "digital"
  ],
  "articleBody": "Photograph of Es Devlin’s “BLUEWHITESKY” at the 2021 LUX exhibition\nMore and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can seem slightly mysterious to someone whose original background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.\nVirtual machines are one of the fundamental building blocks of cloud services and an obvious starting point to the topic. In this post I cover:\n1. Setting up a virtual machine in the cloud\n2. Increasing the security of the machine\n3. Stopping the machine and turning it off\nA cloud based virtual machine can allow access to much greater computing power than is available on a laptop, allowing data processing and model training to be sped up. Alternatively we can also use a less powerful virtual machine to remotely host API calls, webscraping or sites without having to worry about keeping our laptop open to run them.\nIt’s probably true that tools like google colab or serverless are reducing the need for data scientists to directly use virtual machines. However as the cloud increases in importance, knowing more about its core components is useful in general. It also makes it easier to work with different cloud providers as virtual machines are a standard offer.\nPrerequisites The prerequisites are some knowledge of the basics of the command line and networking. If these are less familiar a good way to learn them, or at least I found it helpful, is to buy a raspberry pi and learn how to login remotely to it over your local network (so called “headless login”) as this is similar to many of the steps here - the raspberry pi is effectively acting as a remote machine analagous to the virtual machine in the cloud. A benefit of this approach is that the cost of doing this is fixed and there are fewer security issues as the pi won’t be on the public internet.\nThe instructions should work from a Mac or PC (using windows subsystem for linux) as the local machine. The cloud machine will be linux as this is the most common operating system in the cloud - even on the Microsoft’s Azure cloud platform.\nThe warning no cloud tutorial is without The cloud can be many things, but one thing it is not is free. Although many cloud platforms have free credits for new users, it is important to look at the cost of services before using them, to regularly monitor usage and costs and to turn things off - otherwise things can get expensive.\n1. Setting up a Virtual Machine in the cloud In this example we use a virtual machine (VM) from the cloud provider Digital Ocean. Digital Ocean call their virtual machines Droplets, but in practice there is a lot of similarity between cloud providers' virtual machines. In large part this is because they are mostly linux based, although size and capacity (and hence cost) can vary a lot. Using a virtual machine from another provider such as Amazon Web Service’s (AWS) EC2 instance is quite similar, although in the case of AWS there are some different actions in the set-up and the billing is not capped.\nAfter having created an account, navigate to the Create button in Digital Ocean and select Droplets from the dropdown. We select an Ubuntu instance version of linux on the smallest plan cost which is $5 a month. We choose a local datacenter and a form of authentification. From the authentification options we use Secure Shell (SSH) key based authentification, rather than password based login as this is more secure as it also requires an ssh key to login. If you don’t have an existing key to set up go to the New SSH Key button and follow the steps. To generate a key run $ ssh-keygen from the command line which will then prompt you to give the key a password and save the keys. This will generate two keys: The private one (id_rsa) and the public one (id_rsa.pub) - these are the default names for a new key which will be saved to the ssh folder. Use $ cat ~/.ssh/id_rsa.pub to see the public key and copy and paste this into the indicated field.\nSelect the number of droplets you want to launch. In this case 1 and give the droplet a hostname such as test-virtual-machine. Finally when all the fields are finished hit the Create Droplet button at the bottom and the droplet will launch.\nThe droplet will then launch and its details will be visible (including what its ip address is) under the Droplets tab under Manage. If you replace the ip_address below with the Droplet’s IP address and you should be able to log in from your local machine’s command line using: $ ssh root@ip_address\nif you have multiple ssh keys add the -i flag to add the file path to the specific private key you are using: $ ssh -i /path/to/private_key username@ip_address\nIn the example above the IP address is 134.122.96.10, so the login would be\n$ ssh root@134.122.96.10 The first time you do this you will asked:\nAre you sure you want to continue connecting (yes/no)? Type yes and hit enter and you should see something like the screen below. You now have a machine that, until you turn it off, can run programmes that you want remotely or act as web server 24/7. However, as stands it could be more secure so we take some steps to increase this.\n2. Increasing the security of the machine Unfortunately this stage is necessary as with the virtual machine on the public internet it will quickly be subject to repeated login attempts from bots around the world who are trying to break in.\nIf you want to see these $ lastb | more from the command line of the virtual machine will show you a list of failed login attempts on your virtual machine (The more command makes the list scrollable which becomes necessary given the number of login attempts).\nA small sample of unwanted visitors To help make the virtual machine more secure we therefore:\n Activate a Firewall for the virtual machine which restricts how it can be accessed Create an account which has restricted privileges and only allows access to the machine via that account  In AWS a lot of this is handled through what are known as Identity and Access Managment (IAM) roles. Here we use a standard linux firewall and restrictions on who has access privileges so this is less dependent on the specifics of Digital Ocean. The commands here should be executed on the virtual machine.\n2.1 Activate a Firewall\nTo reduce the scope for this we lock down access to all but one of the ports using a firewall leaving the only means of access the login ssh.\n Installing Uncomplicated Fire Wall (UFW). It should already be installed, but if not, the following command will install the latest version. The cursor now appears as # as we are logged in as root (The account with the highest level of privilege).\n# apt install ufw  Enable ufw to run. The default is to deny all incoming connections and allow all outgoing connections.\n# ufw enable  Check to see if ufw is running.\n# ufw status  Allow ssh connections. This will allow us to only connect with ssh on port 22, which is the standard port for SSH.\n# ufw allow ssh  Restrict the rate at which SSH connections can be formed - this blocks connections from IPs that have attempted 6 or more connections in past 30 seconds.\n# ufw limit ssh  2.2 Create a new user account and prevent access with unrestricted privileges\\\nWe create a user account which we will use to log into the virtual machine going ahead and then remove the direct root access. The reason for doing this is that the default way of logging in with root access gives the user unlimited privileges on the virtual machine, so if someone broke in with the root access default they can do what they want - including locking us out of the system. Allowing access to the root privileges from a new account only with a password restricts this from happening as someone who got access to the machine would also need to force the root password to get this level of control.\n To create a new user account, here called new_user. It will ask you for a password for root access and to input some information on the user.\n# adduser new_user  Give the user ‘new_user’ the admin privileges.\n# usermod -aG sudo new_user  Check you can get the admin privileges. It will prompt you for the new_user password.\n# su - new_user after this it will switch to new_user@test-virtual-machine.  Assuming we want to use the same key for the new user copy the key details over to the new user. # rsync --archive --chown=new_user:new_user ~/.ssh /home/new_user\\ When doing this check ~/.ssh is not written as ~/.ssh/ as if this happens it will copy the whole ssh directory and not just the key  Now log out by typing exit and check you can ssh into the virtual machine from your computer as the new user. It will ask for the key password.\n$ ssh -i /path/to/private_key new_user@ip_address  Assuming you can login as the new user, edit the sshd_config to forbid root logins. If logging in as the new user is not possible then there is a risk of being locked out when you make this change.\n$ sudo nano /etc/ssh/sshd_config  and change the PermitRootLogin line so it reads PermitRootLogin no.Restart the service so that the changes take effect.\n$ sudo service sshd restart  From now on log in as the new user$ ssh -i /path/to/private_key new_user@ip_addressThere are further security restrictions one can implement such as Fail2Ban which will block ip addresses if they make incorrect login attempts more than a set number of times.\nIf the virtual machine is on for an extended length of time it is also important to make sure it is kept up to date, using $ sudo apt-get update \u0026\u0026 apt-get upgrade. The update command updates the list of available packages and upgrade installs the latest version of the packages that the machine has.`\n3. Stopping the machine and turning it off To log out of the virtual machine and leave it running. $ exit will log you out.\nThe following command run from the virtual machine will stop it running and turn its power off. This will disrupt running processes, but retain files that were already saved on the droplets allowing it to be restarted.\n$ sudo shutdown -h now\nYou can also turn off droplets from the web interface which will maintain their state if you relaunch them (although you will still be billed for them while stopped). To destroy the droplet there is a button on the web interface which will remove them and their contents completely ending the billing. The terminology is similar with AWS where EC2 virtual machine instances are ‘stopped’ and ‘destroyed’\nSources:\nDigital Ocean, Guidance on ssh connections https://docs.digitalocean.com/products/droplets/how-to/connect-with-ssh/openssh/\nDigital Ocean, Guidance on ufw https://www.cyberciti.biz/faq/howto-limiting-ssh-connections-with-ufw-on-ubuntu-debian/\nGite, V. Open SSH server best practices https://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html#comments\nFor AWS\nFor a guide on setting up a virtual machine for machine learning on Amazon: Stathoulopoulos, K., How to set up a GPU instance for machine learning on AWS https://kstathou.medium.com/how-to-set-up-a-gpu-instance-for-machine-learning-on-aws-b4fb8ba51a7c\nFor AWS in general Wittig, M. and Andreas, W., ‘Amazon Web Services in action’, Manning.\n",
  "wordCount" : "1964",
  "inLanguage": "en",
  "image":"https://johnardavies.github.io/Cloud_image.jpg","datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "John Davies"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johnardavies.github.io/technical/cloud_intro/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "John's Site",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johnardavies.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://johnardavies.github.io/" accesskey="h" title="John&#39;s Site (Alt + H)">John&#39;s Site</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://johnardavies.github.io/creative_industries" title="creative industries">
                    <span>creative industries</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/talks/" title="talks">
                    <span>talks</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/technical/" title="technical">
                    <span>technical</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/contact/" title="contact">
                    <span>contact</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Introduction to launching a Virtual Machine in the Cloud
    </h1>
    <div class="post-meta">John Davies
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://johnardavies.github.io/Cloud_image.jpg" alt="">
        
</figure>
  <div class="post-content"><p><em>Photograph of Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition</em></p>
<p>More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can seem slightly mysterious to someone whose original background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.</p>
<p>Virtual machines are one of the fundamental building blocks of cloud services and an obvious starting point to the topic.
In this post I cover:</p>
<p><strong>1. Setting up a virtual machine in the cloud</strong><br>
<strong>2. Increasing the security of the machine</strong><br>
<strong>3. Stopping the machine and turning it off</strong></p>
<p>A cloud based virtual machine can allow access to much greater computing power than is available on a laptop, allowing data processing and model training to be sped up. Alternatively we can also use a less powerful virtual machine
to remotely host API calls, webscraping or sites without having to worry about keeping our laptop open to run them.</p>
<p>It&rsquo;s probably true that tools like google colab or serverless are reducing the need for data scientists to directly use virtual machines. However as the cloud increases in importance, knowing more about its core components is useful in general. It also makes it easier to work with different cloud providers as virtual machines are a standard offer.</p>
<p><strong>Prerequisites</strong>
The prerequisites are some knowledge of the basics of the command line and networking. If these are less familiar a good way to learn them, or at least I found it helpful, is to buy a raspberry pi and learn how to login remotely to it over your local network (so called &ldquo;headless login&rdquo;) as this is similar to many of the steps here - the raspberry pi is effectively acting as a remote machine analagous to the virtual machine in the cloud. A benefit of this approach is that the cost of doing this is fixed and there are fewer security issues as the pi won&rsquo;t be on the public internet.</p>
<p>The instructions should work from a Mac or PC (using windows subsystem for linux) as the local machine. The cloud machine will be linux as this is the most common operating system in the cloud - even on the Microsoft&rsquo;s Azure cloud platform.</p>
<p><strong>The warning no cloud tutorial is without</strong> The cloud can be many things, but one thing it is not is free. Although many cloud platforms have free credits for new users, it is important to look at the cost of services before using them, to regularly monitor usage and costs and to turn things off - otherwise things can get expensive.</p>
<h3 id="1--setting-up-a-virtual-machine-in-the-cloud">1.  Setting up a Virtual Machine in the cloud<a hidden class="anchor" aria-hidden="true" href="#1--setting-up-a-virtual-machine-in-the-cloud">#</a></h3>
<p>In this example we use a virtual machine (VM) from the cloud provider <a href="https://cloud.digitalocean.com/">Digital Ocean</a>. Digital Ocean call their virtual machines Droplets, but in practice there is a lot of similarity between cloud providers' virtual machines. In large part this is because they are mostly linux based, although size and capacity (and hence cost) can vary a lot. Using a virtual machine from another provider such as Amazon Web Service&rsquo;s (AWS) EC2 instance is quite similar, although in the case of AWS there are some different actions in the set-up and the billing is not capped.</p>
<p>After having created an account, navigate to the <em>Create</em> button in Digital Ocean and select <em>Droplets</em> from the dropdown.
<img loading="lazy" src="https://johnardavies.github.io/droplet_setup.png" alt="Starting digital ocean"  />

We select an Ubuntu instance version of linux on the smallest plan cost which is $5 a month. We choose a local datacenter and a form of authentification. From the authentification options we use Secure Shell (SSH) key based authentification, rather than password based login as this is more secure as it also requires an ssh key to login. If you don&rsquo;t have an existing key to set up go to the <strong>New SSH Key</strong> button and follow the steps. To generate a key run <code>$ ssh-keygen</code> from the command line which will then prompt you to give the key a password and save the keys. This will generate two keys: The private one (id_rsa) and the public one (id_rsa.pub) - these are the default names for a new key which will be saved to the ssh folder. Use <code>$ cat ~/.ssh/id_rsa.pub</code> to see the public key and copy and paste this into the indicated field.</p>
<p>Select the number of droplets you want to launch. In this case 1 and give the droplet a hostname such as <strong>test-virtual-machine</strong>. Finally when all the fields are finished hit the <strong>Create Droplet</strong> button at the bottom and the droplet will launch.</p>
<p>The droplet will then launch and its details will be visible (including what its ip address is) under the <strong>Droplets</strong> tab under <strong>Manage</strong>.
<img loading="lazy" src="https://johnardavies.github.io/droplet_screen.jpg" alt="Droplet screen"  />
</p>
<p>If you replace the ip_address below with the Droplet&rsquo;s IP address and you should be able to log in from your local machine&rsquo;s command line using:
<code>$ ssh root@ip_address</code><br>
if you have multiple ssh keys add the -i flag to add the file path to the specific private key you are using:
<code>$ ssh -i /path/to/private_key username@ip_address</code></p>
<p>In the example above the IP address is 134.122.96.10, so the login would be<br>
<code>$ ssh root@134.122.96.10</code>
<br>
The first time you do this you will asked:<br>
<code>Are you sure you want to continue connecting (yes/no)?</code>
Type yes and hit enter and you should see something like the screen below.
<img loading="lazy" src="https://johnardavies.github.io/welcome_screen.jpg" alt="Welcome screen"  />

<br>
You now have a machine that, until you turn it off, can run programmes that you want remotely or act as web server 24/7. However, as stands it could be more secure so we take some steps to increase this.</p>
<h3 id="2-increasing-the-security-of-the-machine">2. Increasing the security of the machine<a hidden class="anchor" aria-hidden="true" href="#2-increasing-the-security-of-the-machine">#</a></h3>
<p>Unfortunately this stage is necessary as with the virtual machine on the public internet it will quickly be subject to repeated login attempts from bots around the world who are trying to break in.</p>
<p>If you want to see these <code>$ lastb  | more</code> from the command line of the virtual machine will show you a list of failed login attempts on your virtual machine (The more command makes the list scrollable which becomes necessary given the number of login attempts).<br>
<em>A small sample of unwanted visitors</em>
<img loading="lazy" src="https://johnardavies.github.io/unwanted_visitors.jpg" alt="Unwanted visitors"  />
</p>
<p>To help make the virtual machine more secure we therefore:</p>
<ol>
<li>Activate a Firewall for the virtual machine which restricts how it can be accessed</li>
<li>Create an account which has restricted privileges and only allows access to the machine via that account</li>
</ol>
<p>In AWS a lot of this is handled through what are known as Identity and Access Managment (IAM) roles. Here we use a standard linux firewall and restrictions on who has access privileges so this is less dependent on the specifics of Digital Ocean. The commands here should be executed on the virtual machine.</p>
<p><strong>2.1 Activate a Firewall</strong><br>
To reduce the scope for this we lock down access to all but one of the ports using a firewall leaving the only means of access the login ssh.</p>
<ol>
<li>Installing Uncomplicated Fire Wall (UFW). It should already be installed, but if not, the following command          will  install the latest version. The cursor now appears as # as we are logged in as root (The account with the highest level of privilege).<br>
<code># apt install ufw</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="2">
<li>Enable ufw to run. The default is to deny all incoming connections and allow all outgoing connections.<br>
<code># ufw enable</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="3">
<li>Check to see if ufw is running.<br>
<code># ufw status</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="4">
<li>Allow ssh connections. This will allow us to only connect with ssh on port 22, which is the standard port for SSH.<br>
<code># ufw allow ssh</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="5">
<li>Restrict the rate at which SSH connections can be formed - this blocks connections from IPs that have attempted 6 or more connections in past 30 seconds.<br>
<code># ufw limit ssh</code><!-- raw HTML omitted --></li>
</ol>
<p><strong>2.2 Create a new user account and prevent access with unrestricted privileges</strong>\</p>
<p>We create a user account which we will use to log into the virtual machine going ahead and then remove the direct root access. The reason for doing this is that the default way of logging in with root access gives the user unlimited privileges on the virtual machine, so if someone broke in with the root access default they can do what they want - including locking us out of the system. Allowing access to the root privileges from a new account
only with a password restricts this from happening as someone who got access to the machine would also need to force the root password to get this level of control.</p>
<ol>
<li>To create a new user account, here called new_user. It will ask you for a password for root access and to input some information on the user.<br>
<code># adduser new_user</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="2">
<li>Give the user &lsquo;new_user&rsquo; the admin privileges.<br>
<code># usermod -aG sudo new_user</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="3">
<li>Check you can get the admin privileges. It will prompt you for the new_user password.<br>
<code># su - new_user</code> after this it will switch to <code>new_user@test-virtual-machine</code>.<!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="4">
<li>Assuming we want to use the same key for the new user copy the key details over to the new user.
<code># rsync --archive --chown=new_user:new_user ~/.ssh /home/new_user</code>\
<em>When doing this check ~/.ssh is not written as ~/.ssh/ as if this happens it will copy the whole ssh directory and not just the key</em><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="5">
<li>Now log out by typing <code>exit</code> and check you can ssh into the virtual machine from your computer as the new user. It will ask for the key password.<br>
<code>$ ssh -i /path/to/private_key new_user@ip_address</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="6">
<li>Assuming you can login as the new user, edit the sshd_config to forbid root logins. If logging in as the new user is not possible then there is a risk of being locked out when you make this change.<br>
<code>$ sudo nano /etc/ssh/sshd_config</code><!-- raw HTML omitted --></li>
</ol>
<p>and change the PermitRootLogin line so it reads <code>PermitRootLogin no</code>.<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ol start="7">
<li>Restart the service so that the changes take effect.<br>
<code>$ sudo service sshd restart</code><!-- raw HTML omitted --></li>
</ol>
<p>From now on log in as the new user<!-- raw HTML omitted -->
<code>$ ssh -i /path/to/private_key new_user@ip_address</code><!-- raw HTML omitted --></p>
<p>There are further security restrictions one can implement such as <strong>Fail2Ban</strong> which will block ip addresses if they make incorrect login attempts more than a set number of times.</p>
<p>If the virtual machine is on for an extended length of time it is also important to make sure it is kept up to date, using <code>$ sudo apt-get update &amp;&amp; apt-get upgrade</code>. The update command updates the list of available packages and upgrade installs the latest version of the packages that the machine has.`</p>
<h3 id="3-stopping-the-machine-and-turning-it-off">3. Stopping the machine and turning it off<a hidden class="anchor" aria-hidden="true" href="#3-stopping-the-machine-and-turning-it-off">#</a></h3>
<p>To log out of the virtual machine and leave it running.
<code>$ exit</code> will log you out.</p>
<p>The following command run from the virtual machine will stop it running and turn its power off. This will disrupt running processes, but retain files that were already saved on the droplets allowing it to be restarted.<br>
<code>$ sudo shutdown -h now</code></p>
<p>You can also turn off droplets from the web interface which will maintain their state if you relaunch them (although you will still be billed for them while stopped).
To destroy the droplet there is a button on the web interface which will remove them and their contents completely ending the billing.
The terminology is similar with AWS where EC2 virtual machine instances are &lsquo;stopped&rsquo; and &lsquo;destroyed&rsquo;</p>
<p><strong>Sources:</strong></p>
<p>Digital Ocean, Guidance on ssh connections
<a href="https://docs.digitalocean.com/products/droplets/how-to/connect-with-ssh/openssh/">https://docs.digitalocean.com/products/droplets/how-to/connect-with-ssh/openssh/</a></p>
<p>Digital Ocean, Guidance on ufw
<a href="https://www.cyberciti.biz/faq/howto-limiting-ssh-connections-with-ufw-on-ubuntu-debian/">https://www.cyberciti.biz/faq/howto-limiting-ssh-connections-with-ufw-on-ubuntu-debian/</a></p>
<p>Gite, V. Open SSH server best practices
<a href="https://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html#comments">https://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html#comments</a></p>
<p>For AWS</p>
<p>For a guide on setting up a virtual machine for machine learning on Amazon:
Stathoulopoulos, K., How to set up a GPU instance for machine learning on AWS
<a href="https://kstathou.medium.com/how-to-set-up-a-gpu-instance-for-machine-learning-on-aws-b4fb8ba51a7c">https://kstathou.medium.com/how-to-set-up-a-gpu-instance-for-machine-learning-on-aws-b4fb8ba51a7c</a></p>
<p>For AWS in general
Wittig, M. and Andreas, W., &lsquo;Amazon Web Services in action&rsquo;, Manning.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://johnardavies.github.io/tags/technical/">technical</a></li>
      <li><a href="https://johnardavies.github.io/tags/digital/">digital</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://johnardavies.github.io/">John&#39;s Site</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>



