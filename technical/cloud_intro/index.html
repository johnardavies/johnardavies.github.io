<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Cloud 1: Introduction to launching a Virtual Machine in the Cloud | John&#39;s Site</title>
<meta name="keywords" content="technical, digital, cloud" />
<meta name="description" content="Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition
More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can be slightly opaque to someone whose background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.">
<meta name="author" content="John Davies">
<link rel="canonical" href="https://johnardavies.github.io/technical/cloud_intro/" />
<link crossorigin="anonymous" href="https://johnardavies.github.io/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css" integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw&#43;W8mWdq36u97PLc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="https://johnardavies.github.io/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://johnardavies.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://johnardavies.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://johnardavies.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://johnardavies.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://johnardavies.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.88.1" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-YJ821LVT08', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-YJ821LVT08"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-YJ821LVT08', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Cloud 1: Introduction to launching a Virtual Machine in the Cloud" />
<meta property="og:description" content="Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition
More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can be slightly opaque to someone whose background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://johnardavies.github.io/technical/cloud_intro/" />
<meta property="og:image" content="https://johnardavies.github.io/Cloud_image.jpg" /><meta property="article:section" content="technical" />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://johnardavies.github.io/Cloud_image.jpg" />
<meta name="twitter:title" content="Cloud 1: Introduction to launching a Virtual Machine in the Cloud"/>
<meta name="twitter:description" content="Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition
More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can be slightly opaque to someone whose background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Technicals",
      "item": "https://johnardavies.github.io/technical/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Cloud 1: Introduction to launching a Virtual Machine in the Cloud",
      "item": "https://johnardavies.github.io/technical/cloud_intro/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Cloud 1: Introduction to launching a Virtual Machine in the Cloud",
  "name": "Cloud 1: Introduction to launching a Virtual Machine in the Cloud",
  "description": "Es Devlin\u0026rsquo;s \u0026ldquo;BLUEWHITESKY\u0026rdquo; at the 2021 LUX exhibition\nMore and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can be slightly opaque to someone whose background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.",
  "keywords": [
    "technical", "digital", "cloud"
  ],
  "articleBody": "Es Devlin’s “BLUEWHITESKY” at the 2021 LUX exhibition\nMore and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can be slightly opaque to someone whose background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.\nVirtual machines, as the main way to access cloud computing power, are one of the fundamental building blocks of cloud services and an obvious starting point to the topic. In this post I cover:\n1. Setting up a virtual machine in the cloud\n2. Increasing the security of the machine\n3. Stopping the machine and turning it off\nA cloud based virtual machine can allow access to much greater computing power than is available on a laptop, enabling data processing and model training to be sped up. Alternatively a less powerful virtual machine can be used to remotely host API calls, webscraping or sites without having to worry about keeping a computer on all the time to run them.\nIt’s probably true that tools like Google Colab or Serverless are reducing the need for data scientists to directly use virtual machines. However as the cloud increases in importance, knowing more about its core components is useful in general. It also makes it easier to work with different cloud providers as virtual machines are a standard offer.\nPrerequisites The prerequisites are some knowledge of the command line and networking. If these are less familiar a good way to learn them, or at least I found it helpful, is to buy a Raspberry Pi and learn how to login remotely to it over your local network (so called “headless login”) as this is similar to many of the steps here - the Raspberry Pi is effectively acting as a remote machine analagous to the virtual machine in the cloud. A benefit of this approach is that (the small electricity bill aside) the cost of doing this is fixed and there are fewer security issues as the Pi won’t be on the public internet.\nThe instructions should work from a Mac (or PC using Windows subsystem for Linux) as the local machine. The cloud machine will be Linux as this is the most common operating system in the cloud - even on the Microsoft’s Azure cloud platform.\nThe warning no cloud tutorial is without The cloud can be many things, but one thing it is not is free. Although many cloud platforms have free credits for new users, it is important to look at the cost of services before using them, to regularly monitor usage and costs and to turn things off - otherwise things can get expensive.\n1. Setting up a Virtual Machine in the cloud In this example we use a virtual machine (VM) from the cloud provider Digital Ocean. Digital Ocean call their virtual machines Droplets, but in practice there is a lot of similarity between cloud providers' virtual machines. In large part this is because they are mostly Linux based, although size and capacity (and hence cost) can vary a lot. Using a virtual machine from another provider such as Amazon Web Service’s (AWS) EC2 instance is quite similar, although in the case of AWS there are some different actions in the set-up and the billing is not capped.\nAfter having created an account, navigate to the Create button in Digital Ocean and select Droplets from the dropdown. A screen like the below should then be visible. We select an Ubuntu instance version of Linux on the smallest plan cost which is $5 a month. We choose a local datacenter and a form of authentification. From the authentification options we use Secure Shell (SSH) key based authentification, rather than password based login as this is more secure as it also requires an ssh key to login.\nIf you don’t have an existing key to set up go to the New SSH Key button and follow the steps. To generate a key run $ ssh-keygen from the command line which will then prompt you to give the key a password and save it. This generates a key pair: A private key (id_rsa) and a public key (id_rsa.pub) - these are the default names for the key pair which will be saved to the ssh folder. We share the public key with the virtual machine by running $ cat ~/.ssh/id_rsa.pub to see the public key and copying and pasting this into the indicated field on the web form.\nSelect the number of droplets you want to launch. In this case 1 and give the droplet a hostname such as test-virtual-machine. Finally when all the fields are complete hit the Create Droplet button at the bottom and the droplet will launch which may take a few seconds.\nThe details of the droplet will be visible (including what its IP address is) by selecting the Droplets tab under Manage. You should then be able to log in from your local machine using the command below where ip_address is replaced by the virtual machine’s IP address:\n$ ssh root@ip_address\nIn the example above the IP address is 134.122.96.10, so the login would be:\n$ ssh root@134.122.96.10\nIf you have multiple ssh keys add the -i flag and the file path to the specific private key you are using: $ ssh -i /path/to/private_key root@ip_address\nThe first time you do this the command prompt will say:\nAre you sure you want to continue connecting (yes/no)? Type yes and hit enter, if you have set a key password it will ask for this to be input, and after doing that you should see something like the screen below. We now have a virtual machine in the cloud that, until turned off, can run programmes remotely or act as web server 24/7. However, it is generally recommended to implement some measures to make it more secure (particularly if it is on for an extended period) so we now do this.\n2. Increasing the security of the machine Unfortunately this stage is necessary as with the virtual machine on the public internet it will quickly be subject to repeated login attempts from bots around the world who are trying to break in.\nIf you want to see these running $ lastb | more from the command line of the virtual machine not long after launching will usually show you a list of failed login attempts on the machine.\nA small sample of unwanted visitors To help make the virtual machine more secure we therefore:\n Activate a Firewall for the virtual machine which restricts how it can be accessed Create an account on the machine which has restricted privileges and then only allow access to the machine via that account  In AWS a lot of this is handled through what are known as Identity and Access Managment (IAM) roles. Here we use a standard Linux firewall and restrictions on who has access privileges so this is less dependent on the specifics of Digital Ocean. The commands here should be executed on the virtual machine unless stated otherwise.\n2.1 Activate a Firewall\nTo reduce the scope to access the machine we use a firewall to block access to all but one of the virtual machine’s ports leaving the only means of access the login ssh.\n Installing Uncomplicated Firewall (UFW). If UFW is not already installed, the following command will install the latest version. The cursor now appears as # as we are logged in as root on the machine (The account with the highest level of privilege) e.g. root@test-virtual-machine.\n# apt install ufw  Allow ssh connections. Once the firewall is activated this will allow connections with ssh on port 22, which is the standard port for SSH.\n# ufw allow ssh  Enable ufw to run. The default is to deny all incoming connections and allow all outgoing connections. If access via ssh not enabled before doing this there is a risk of getting locked out.\n# ufw enable  Check to see if ufw is running.\n# ufw status  Restrict the rate at which SSH connections can be formed (as can be seen in the example above bots often target the ssh port) - this blocks connections from IPs that have attempted 6 or more connections in past 30 seconds.\n# ufw limit ssh  The image below shows what this process should look like in the terminal. An additional firewall restriction one could impose would be to restrict access to the machine to just your home IP address, which would block the remote logins. The configuration in the example does not do this as it allows access from “Anywhere”.\nThere are further security measures one can implement such as Fail2Ban which will block IP addresses if they make incorrect login attempts more than a set number of times.\n2.2 Create a new user account and prevent access with unrestricted privileges\nWe create a user account which we will use to log into the virtual machine going ahead and then remove the direct root access. The reason for doing this is that the default way of logging in with root access gives the user unlimited privileges on the virtual machine. This means that if someone broke in with the root access default they can do what they want - including locking us out of the system (although there are ways to restore this from the web console). Allowing access to the root privileges from a new account only with a password restricts this from happening as someone who got access to the machine would also need to force the user password to get this level of control.\n To create a new user account on the machine, here called new_user, run the below. The machine will ask you to create a password for the user and to input some information on the user.\n# adduser new_user  Give the user ‘new_user’ the administrator access privileges by adding them to the sudo (superuser do) group (This is what the -aG command does).\n# usermod -aG sudo new_user  Check you can get the sudo access. Running # su - new_user will switch to the new_user account new_user@test-virtual-machine.Then run $ sudo -v, which will ask for the password you set up for the new user in 1. and if input correctly verifies that new_user has sudo access. The password is needed to access sudo going ahead.  Type exit to switch back to root from new_user and assuming we want to use the same key for the new user as we did to login originally copy the key details over to the new user. # rsync --archive --chown=new_user:new_user ~/.ssh /home/new_user When doing this check ~/.ssh is not written as ~/.ssh/ as if this happens it will copy the contents of the ssh directory, but not its folder structure which will mean ssh can’t find the key.  Now log out of root to switch to your local machine by typing exit and check you can ssh into the virtual machine from your computer as the new user with the following command, it will ask for the key password (not the password for the new_user).\n$ ssh -i /path/to/private_key new_user@ip_address  What these stages look like is shown in the example below. Some information has been removed. Assuming you can login as the new user, edit the sshd_config to forbid root logins with the following command $ sudo nano /etc/ssh/sshd_configand change the PermitRootLogin line so it reads PermitRootLogin no  If logging in as the new user is not possible then there is a risk of being locked out when you make this change while running as root.\nRestart the service so that the changes take effect.\n$ sudo service sshd restart  From now on log in as the new user$ ssh -i /path/to/private_key new_user@ip_addressIf the virtual machine is on for an extended length of time it is also important to make sure it is kept up to date using $ sudo apt-get update \u0026\u0026 apt-get upgrade. The update command updates the list of available packages and upgrade installs the latest version of the packages that the machine has.\n3. Stopping the machine and turning it off To log out of the virtual machine and leave it running $ exit will log you out.\nThe following command run from the virtual machine will stop it running and turn its power off: $ sudo shutdown -h now. This will disrupt running processes, but retain files that were already saved allowing it to be restarted. You can also turn off the machine from the web interface which will maintain its state if you relaunch it.\nYou will still be billed for the virtual machine while stopped, to stop the billing you also have delete the machine and its contents. To do this there is a tab on the web interface marked Destroy. The terminology is similar with AWS where EC2 virtual machine instances are ‘stopped’ and ‘terminated’. Sources:\nDigital Ocean, “How to Connect to your Droplet with OpenSSH” https://docs.digitalocean.com/products/droplets/how-to/connect-with-ssh/openssh/\nBrian Boucheron and Erika Heidi (2021), “How To Set Up a Firewall with UFW on Ubuntu 18.04”. This gives more detail on ufw settings. https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04\nVivek Gite, “Open SSH server best practices”. This has a detailed review on ssh security techniques for servers. https://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html#comments\nFor AWS\nFor a guide on setting up a virtual machine for machine learning on Amazon:\nKostas Stathoulopoulos, How to set up a GPU instance for machine learning on AWS https://kstathou.medium.com/how-to-set-up-a-gpu-instance-for-machine-learning-on-aws-b4fb8ba51a7c\nFor a book on AWS in general Andreas and Michael Wittig, ‘Amazon Web Services in action’, Manning.\nOther cloud posts: Cloud 2: Getting started with using a Virtual Machine in the Cloud\nCloud 3: Docker and Jupyter notebooks in the Cloud\nCloud 4: Using Serverless\nCloud 5: Introduction to deploying an app with simple CI/CD\n",
  "wordCount" : "2333",
  "inLanguage": "en",
  "image":"https://johnardavies.github.io/Cloud_image.jpg","datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "John Davies"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://johnardavies.github.io/technical/cloud_intro/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "John's Site",
    "logo": {
      "@type": "ImageObject",
      "url": "https://johnardavies.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://johnardavies.github.io/" accesskey="h" title="John&#39;s Site (Alt + H)">John&#39;s Site</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://johnardavies.github.io/creative_industries" title="creative industries">
                    <span>creative industries</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/other_data_projects" title="other data projects">
                    <span>other data projects</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/talks/" title="talks">
                    <span>talks</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/technical/" title="technical posts">
                    <span>technical posts</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://johnardavies.github.io/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Cloud 1: Introduction to launching a Virtual Machine in the Cloud
    </h1>
    <div class="post-meta">John Davies
</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://johnardavies.github.io/Cloud_image.jpg" alt="">
        
</figure>
  <div class="post-content"><p><em>Es Devlin&rsquo;s &ldquo;BLUEWHITESKY&rdquo; at the 2021 LUX exhibition</em></p>
<p>More and more of the digital services we use involve the cloud, where the computing is not done on our laptop or mobile, but accessed over the internet. However, coming across its technical details for the first time, the cloud can be slightly opaque to someone whose background is not computing - I certainly found it that way. From a data science perspective working with it involves things that are not related to statistics, machine learning or even programming narrowly defined.</p>
<p>Virtual machines, as the main way to access cloud computing power, are one of the fundamental building blocks of cloud services and an obvious starting point to the topic.
In this post I cover:</p>
<p><strong>1. Setting up a virtual machine in the cloud</strong><br>
<strong>2. Increasing the security of the machine</strong><br>
<strong>3. Stopping the machine and turning it off</strong></p>
<p>A cloud based virtual machine can allow access to much greater computing power than is available on a laptop, enabling data processing and model training to be sped up. Alternatively a less powerful virtual machine can be used
to remotely host API calls, webscraping or sites without having to worry about keeping a computer on all the time to run them.</p>
<p>It&rsquo;s probably true that tools like Google Colab or Serverless are reducing the need for data scientists to directly use virtual machines. However as the cloud increases in importance, knowing more about its core components is useful in general. It also makes it easier to work with different cloud providers as virtual machines are a standard offer.</p>
<p><strong>Prerequisites</strong>
The prerequisites are some knowledge of the command line and networking. If these are less familiar a good way to learn them, or at least I found it helpful, is to buy a Raspberry Pi and learn how to login remotely to it over your local network (so called &ldquo;headless login&rdquo;) as this is similar to many of the steps here - the Raspberry Pi is effectively acting as a remote machine analagous to the virtual machine in the cloud. A benefit of this approach is that (the small electricity bill aside) the cost of doing this is fixed and there are fewer security issues as the Pi won&rsquo;t be on the public internet.</p>
<p>The instructions should work from a Mac (or PC using Windows subsystem for Linux) as the local machine. The cloud machine will be Linux as this is the most common operating system in the cloud - even on the Microsoft&rsquo;s Azure cloud platform.</p>
<p><strong>The warning no cloud tutorial is without</strong> The cloud can be many things, but one thing it is not is free. Although many cloud platforms have free credits for new users, it is important to look at the cost of services before using them, to regularly monitor usage and costs and to turn things off - otherwise things can get expensive.</p>
<h3 id="1--setting-up-a-virtual-machine-in-the-cloud">1.  Setting up a Virtual Machine in the cloud<a hidden class="anchor" aria-hidden="true" href="#1--setting-up-a-virtual-machine-in-the-cloud">#</a></h3>
<p>In this example we use a virtual machine (VM) from the cloud provider <a href="https://cloud.digitalocean.com/">Digital Ocean</a>. Digital Ocean call their virtual machines Droplets, but in practice there is a lot of similarity between cloud providers' virtual machines. In large part this is because they are mostly Linux based, although size and capacity (and hence cost) can vary a lot. Using a virtual machine from another provider such as Amazon Web Service&rsquo;s (AWS) EC2 instance is quite similar, although in the case of AWS there are some different actions in the set-up and the billing is not capped.</p>
<p>After having created an account, navigate to the <strong>Create</strong> button in Digital Ocean and select <strong>Droplets</strong> from the dropdown. A screen like the below should then be visible.
<img loading="lazy" src="https://johnardavies.github.io/droplet_setup.png" alt="Starting digital ocean"  />

We select an Ubuntu instance version of Linux on the smallest plan cost which is $5 a month. We choose a local datacenter and a form of authentification. From the authentification options we use <a href="https://en.wikipedia.org/wiki/Secure_Shell"><strong>Secure Shell (SSH)</strong></a> key based authentification, rather than password based login as this is more secure as it also requires an ssh key to login.</p>
<p>If you don&rsquo;t have an existing key to set up go to the <strong>New SSH Key</strong> button and follow the steps. To generate a key run <code>$ ssh-keygen</code> from the command line which will then prompt you to give the key a password and save it. This generates a key pair: A private key (id_rsa) and a public key (id_rsa.pub) - these are the default names for the key pair which will be saved to the ssh folder. We share the public key with the virtual machine by running <code>$ cat ~/.ssh/id_rsa.pub</code> to see the public key and copying and pasting this into the indicated field on the web form.</p>
<p>Select the number of droplets you want to launch. In this case 1 and give the droplet a hostname such as <strong>test-virtual-machine</strong>. Finally when all the fields are complete  hit the <strong>Create Droplet</strong> button at the bottom and the droplet will launch which may take a few seconds.</p>
<p>The details of the droplet will be visible (including what its IP address is) by selecting the <strong>Droplets</strong> tab under <strong>Manage</strong>.
<img loading="lazy" src="https://johnardavies.github.io/droplet_screen.jpg" alt="Droplet screen"  />
</p>
<p>You should then be able to log in from your local machine using the command below where ip_address is replaced by the virtual machine&rsquo;s IP address:<br>
<code>$ ssh root@ip_address</code><br>
In the example above the IP address is 134.122.96.10, so the login would be:<br>
<code>$ ssh root@134.122.96.10</code></p>
<p>If you have multiple ssh keys add the -i flag and the file path to the specific private key you are using:
<code>$ ssh -i /path/to/private_key root@ip_address</code></p>
<p>The first time you do this the command prompt will say:<br>
<code>Are you sure you want to continue connecting (yes/no)?</code>
Type yes and hit enter, if you have set a key password it will ask for this to be input, and after doing that you should see something like the screen below.
<img loading="lazy" src="https://johnardavies.github.io/welcome_screen.jpg" alt="Welcome screen"  />

<br>
We now have a virtual machine in the cloud that, until turned off, can run programmes remotely or act as web server 24/7. However, it is generally recommended to implement some measures to make it  more secure (particularly if it is on for an extended period) so we now do this.</p>
<h3 id="2-increasing-the-security-of-the-machine">2. Increasing the security of the machine<a hidden class="anchor" aria-hidden="true" href="#2-increasing-the-security-of-the-machine">#</a></h3>
<p>Unfortunately this stage is necessary as with the virtual machine on the public internet it will quickly be subject to repeated login attempts from bots around the world who are trying to break in.</p>
<p>If you want to see these running <code>$ lastb  | more</code> from the command line of the virtual machine not long after launching  will usually show you a list of failed login attempts on the  machine.<br>
<em>A small sample of unwanted visitors</em>
<img loading="lazy" src="https://johnardavies.github.io/unwanted_visitors.jpg" alt="Unwanted visitors"  />
</p>
<p>To help make the virtual machine more secure we therefore:</p>
<ol>
<li>Activate a Firewall for the virtual machine which restricts how it can be accessed</li>
<li>Create an account on the machine which has restricted privileges and then only allow access to the machine via that account</li>
</ol>
<p>In AWS a lot of this is handled through what are known as Identity and Access Managment (IAM) roles. Here we use a standard Linux firewall and restrictions on who has access privileges so this is less dependent on the specifics of Digital Ocean. The commands here should be executed on the virtual machine unless stated otherwise.</p>
<p><strong>2.1 Activate a Firewall</strong></p>
<p>To reduce the scope to access the machine we use a firewall to block access to all but one of the virtual machine&rsquo;s ports leaving the only means of access the login ssh.</p>
<ol>
<li>Installing Uncomplicated Firewall (UFW). If UFW is not already installed, the following command will install the latest version. The cursor now appears as # as we are logged in as root on the machine (The account with the highest level of privilege) e.g. root@test-virtual-machine.<br>
<code># apt install ufw</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="2">
<li>Allow ssh connections. Once the firewall is activated this will allow connections with ssh on port 22, which is the standard port for SSH.<br>
<code># ufw allow ssh</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="3">
<li>Enable ufw to run. The default is to deny all incoming connections and allow all outgoing connections. If access via ssh not enabled before doing this there is a risk of getting locked out.<br>
<code># ufw enable</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="3">
<li>Check to see if ufw is running.<br>
<code># ufw status</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="4">
<li>Restrict the rate at which SSH connections can be formed (as can be seen in the example above bots often target the ssh port) - this blocks connections from IPs that have attempted 6 or more connections in past 30 seconds.<br>
<code># ufw limit ssh</code><!-- raw HTML omitted --></li>
</ol>
<p>The image below shows what this process should look like in the terminal.
<img loading="lazy" src="https://johnardavies.github.io/ufw_example.jpg" alt="UFW example"  />

An additional firewall restriction one could impose would be to restrict access to the machine to just your home IP address, which would block the remote logins. The configuration in the example does not do this as it allows access from &ldquo;Anywhere&rdquo;.</p>
<p>There are further security measures one can implement such as <strong>Fail2Ban</strong> which will block IP addresses if they make incorrect login attempts more than a set number of times.</p>
<p><strong>2.2 Create a new user account and prevent access with unrestricted privileges</strong></p>
<p>We create a user account which we will use to log into the virtual machine going ahead and then remove the direct root access. The reason for doing this is that the default way of logging in with root access gives the user unlimited privileges on the virtual machine. This means that if someone broke in with the root access default they can do what they want - including locking us out of the system (although there are ways to restore this from the web console). Allowing access to the root privileges from a new account
only with a password restricts this from happening as someone who got access to the machine would also need to force the user password to get this level of control.</p>
<ol>
<li>To create a new user account on the machine, here called new_user, run the below. The machine will ask you to create a password for the user and to input some information on the user.<br>
<code># adduser new_user</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="2">
<li>Give the user &lsquo;new_user&rsquo; the administrator access privileges by adding them to the sudo (superuser do) group (This is what the -aG command does).<br>
<code># usermod -aG sudo new_user</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="3">
<li>Check you can get the sudo access. Running <code># su - new_user</code> will switch to the new_user account <code>new_user@test-virtual-machine</code>.<!-- raw HTML omitted -->
Then run <code>$ sudo -v</code>, which will ask for the password you set up for the new user in 1. and if input correctly verifies that new_user has sudo access. The password is needed to access sudo going ahead.</li>
</ol>
<!-- raw HTML omitted -->
<ol start="4">
<li>Type <code>exit</code> to switch back to root from new_user and assuming we want to use the same key for the new user as we did to login originally copy the key details over to the new user.
<code># rsync --archive --chown=new_user:new_user ~/.ssh /home/new_user</code>
<em>When doing this check ~/.ssh is not written as ~/.ssh/ as if this happens it will copy the contents of the ssh directory, but not its folder structure which will mean ssh can&rsquo;t find the key.</em><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<ol start="5">
<li>Now log out of root to switch to your local machine  by typing <code>exit</code> and check you can ssh into the virtual machine from your computer as the new user with the following command, it will ask for the key password (not the password for the new_user).<br>
<code>$ ssh -i /path/to/private_key new_user@ip_address</code><!-- raw HTML omitted --></li>
</ol>
<!-- raw HTML omitted -->
<p>What these stages look like is shown in the example below. Some information has been removed.
<img loading="lazy" src="https://johnardavies.github.io/new_user_example.png" alt="New user example"  />
</p>
<ol start="6">
<li>Assuming you can login as the new user, edit the sshd_config to forbid root logins with the following command
<code>$ sudo nano /etc/ssh/sshd_config</code><!-- raw HTML omitted -->
and change the PermitRootLogin line so it reads <code>PermitRootLogin no</code><!-- raw HTML omitted --></li>
</ol>
<p><em>If logging in as the new user is not possible then there is a risk of being locked out when you make this change while running as root.</em></p>
<!-- raw HTML omitted -->
<ol start="7">
<li>Restart the service so that the changes take effect.<br>
<code>$ sudo service sshd restart</code><!-- raw HTML omitted --></li>
</ol>
<p>From now on log in as the new user<!-- raw HTML omitted -->
<code>$ ssh -i /path/to/private_key new_user@ip_address</code><!-- raw HTML omitted --></p>
<p>If the virtual machine is on for an extended length of time it is also important to make sure it is kept up to date using <code>$ sudo apt-get update &amp;&amp; apt-get upgrade</code>. The update command updates the list of available packages and upgrade installs the latest version of the packages that the machine has.</p>
<h3 id="3-stopping-the-machine-and-turning-it-off">3. Stopping the machine and turning it off<a hidden class="anchor" aria-hidden="true" href="#3-stopping-the-machine-and-turning-it-off">#</a></h3>
<p>To log out of the virtual machine and leave it running
<code>$ exit</code> will log you out.</p>
<p>The following command run from the virtual machine will stop it running and turn its power off:
<code>$ sudo shutdown -h now</code>.
This will disrupt running processes, but retain files that were already saved allowing it to be restarted.
You can also turn off the machine from the web interface which will maintain its state if you relaunch it.</p>
<p>You will still be billed for the virtual machine while stopped, to stop the billing you also have delete the machine and its contents.
To do this there is a tab on the web interface marked <strong>Destroy</strong>.
The terminology is similar with AWS where EC2 virtual machine instances are &lsquo;stopped&rsquo; and &lsquo;terminated&rsquo;.
<img loading="lazy" src="https://johnardavies.github.io/droplet_screen_2.jpg" alt="Turn off example"  />
</p>
<p><strong>Sources:</strong></p>
<p>Digital Ocean, &ldquo;How to Connect to your Droplet with OpenSSH&rdquo;
<a href="https://docs.digitalocean.com/products/droplets/how-to/connect-with-ssh/openssh/">https://docs.digitalocean.com/products/droplets/how-to/connect-with-ssh/openssh/</a></p>
<p>Brian Boucheron and Erika Heidi (2021), &ldquo;How To Set Up a Firewall with UFW on Ubuntu 18.04&rdquo;. This gives more detail on ufw settings.
<a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04</a></p>
<p>Vivek Gite, &ldquo;Open SSH server best practices&rdquo;. This has a detailed review on ssh security techniques for servers.
<a href="https://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html#comments">https://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html#comments</a></p>
<p><em>For AWS</em></p>
<p>For a guide on setting up a virtual machine for machine learning on Amazon:<br>
Kostas Stathoulopoulos, How to set up a GPU instance for machine learning on AWS
<a href="https://kstathou.medium.com/how-to-set-up-a-gpu-instance-for-machine-learning-on-aws-b4fb8ba51a7c">https://kstathou.medium.com/how-to-set-up-a-gpu-instance-for-machine-learning-on-aws-b4fb8ba51a7c</a></p>
<p>For a book on AWS in general
Andreas and Michael Wittig, &lsquo;Amazon Web Services in action&rsquo;, Manning.</p>
<h3 id="other-cloud-posts">Other cloud posts:<a hidden class="anchor" aria-hidden="true" href="#other-cloud-posts">#</a></h3>
<p><em><strong><a href="https://johnardavies.github.io/technical/cloud_use/">Cloud 2: Getting started with using a Virtual Machine in the Cloud</a></strong></em></p>
<p><em><strong><a href="https://johnardavies.github.io/technical/docker_use/">Cloud 3: Docker and Jupyter notebooks in the Cloud</a></strong></em></p>
<p><em><strong><a href="https://johnardavies.github.io/technical/serverless/">Cloud 4: Using Serverless</a></strong></em></p>
<p><em><strong><a href="https://johnardavies.github.io/technical/front_end/">Cloud 5: Introduction to deploying an app with simple CI/CD</a></strong></em></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://johnardavies.github.io/tags/technical/">technical</a></li>
      <li><a href="https://johnardavies.github.io/tags/digital/">digital</a></li>
      <li><a href="https://johnardavies.github.io/tags/cloud/">cloud</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://johnardavies.github.io/">John&#39;s Site</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
